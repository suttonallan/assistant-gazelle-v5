# R√®gles Cursor pour Assistant Gazelle V5

## üìñ Documentation √† Lire au D√©marrage

Quand tu d√©marres une nouvelle conversation dans ce projet, commence TOUJOURS par lire ces fichiers dans cet ordre:

1. **`docs/ETAT_SESSION_ACTUELLE.md`** - √âtat du projet, travaux en cours, fonctionnalit√©s compl√©t√©es
2. **`INSTRUCTIONS_CURSOR_FINALISER_CLIENTS_CLIQUABLES.md`** - T√¢che prioritaire en cours

## üéØ T√¢che Actuelle Prioritaire

Finaliser les clients cliquables dans le chat assistant. Tous les d√©tails sont dans `INSTRUCTIONS_CURSOR_FINALISER_CLIENTS_CLIQUABLES.md`.

## üö´ R√®gles Importantes

1. **Ne PAS over-engineer** - Solutions simples et directes uniquement
2. **Ne PAS cr√©er de documentation** non demand√©e
3. **Ne PAS utiliser d'emojis** sauf si explicitement demand√©
4. **Ne PAS modifier** les fichiers sans raison claire
5. **Toujours v√©rifier** `docs/ETAT_SESSION_ACTUELLE.md` avant de commencer
6. **Ne JAMAIS essayer de pusher avec git push** - L'utilisateur push toujours via l'application GitHub Desktop. Cr√©er les commits, mais laisser l'utilisateur pusher.

## üìö GESTION STRICTE DE LA DOCUMENTATION

**R√àGLES CRITIQUES:**

1. **INTERDICTION de cr√©er de nouveaux fichiers** dans `assistant-v6/docs/` ou `.cursor/docs/` sans permission explicite
2. **OBLIGATION de mettre √† jour les fichiers existants** avant tout changement de code:
   - `DATA_RELATIONS.md` - Relations entre tables, navigation, r√®gles critiques
   - `DATA_DICTIONARY.md` - Sch√©ma des tables, colonnes
   - `REGLE_IDS_GAZELLE.md` - Mapping des IDs techniciens
3. **Avant chaque modification de code**, tu DOIS:
   - Citer le fichier de doc que tu consultes
   - V√©rifier que la r√®gle existe dans la doc
   - Si nouvelle r√®gle d√©couverte: chercher dans quel doc existant elle appartient
4. **Si tu cr√©es un nouveau fichier temporaire**:
   - L'utilisateur te demandera de le supprimer
   - Tu devras int√©grer le contenu dans un doc existant

**Workflow correct:**
```
1. Lire DATA_RELATIONS.md (si touche aux tables)
2. Modifier le code
3. Mettre √† jour DATA_RELATIONS.md avec la nouvelle r√®gle d√©couverte
4. Ne JAMAIS cr√©er de nouveau fichier (DATA_FLOW.md, etc.)
```

## üîê S√âCURIT√â - SECRETS (CRITIQUE)

**AVANT CHAQUE COMMIT - SCANNER AUTOMATIQUEMENT:**

Patterns de secrets √† d√©tecter:
- `AIza[A-Za-z0-9_-]{35,}` ‚Üí Google API keys
- `SG\.[A-Za-z0-9_-]{20,}` ‚Üí SendGrid keys
- `eyJ[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+` ‚Üí JWT tokens (Supabase)
- Fichiers: `*SECRETS*.md`, `*credentials*.json`, `.env`

**Si secret d√©tect√©:**
1. ‚ùå STOP - Ne pas commiter
2. ‚ö†Ô∏è Alerter l'utilisateur imm√©diatement
3. ‚úÖ Proposer d'ajouter √† `.gitignore`

**Fichiers JAMAIS √† commiter:**
- `.env`, `.env.local`, `.env.*.local`
- `docs/SECRETS_REFERENCE.md`
- `SECRETS_PERMANENTS.md`
- `config/token.json`, `*credentials*.json`

## üèóÔ∏è Stack Technique

- **Backend:** FastAPI (Python) sur port 8000
- **Frontend:** React + Vite + Tailwind CSS
- **Base de donn√©es:** Supabase (PostgreSQL)
- **Auth:** PIN √† 4 chiffres (simple)

## üìù Conventions de Code

- **Python:** PEP 8, type hints optionnels
- **React:** Functional components, hooks
- **CSS:** Tailwind classes uniquement
- **Commits:** Messages en fran√ßais, descriptifs

## ‚ö° Commandes Rapides

```bash
# Backend
python3 -m uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload

# Frontend
cd frontend && npm run dev

# D√©ploiement
cd frontend && bash deploy-gh-pages.sh
```

## üí° Rappels

- L'utilisateur travaille avec **GitHub Desktop** pour pousser (pas CLI)
- L'utilisateur pr√©f√®re des **explications concises**
- Toujours **tester localement** avant de pousser

## üéØ OAuth Gazelle - Le√ßons Apprises

**Redirect URI:**
- ‚ùå JAMAIS `urn:ietf:wg:oauth:2.0:oob` (Gazelle refuse)
- ‚úÖ TOUJOURS HTTPS: `https://assistant-gazelle-v5-api.onrender.com/gazelle_oauth_callback`

**Nouvelles applications:**
- ‚è≥ Attendre 24-48h apr√®s cr√©ation pour activation
- ‚úÖ V√©rifier dans dashboard Gazelle avant d'utiliser

**D√©pannage:**
- Lire la DOCUMENTATION disponible avant d'essayer
- Ne JAMAIS deviner des valeurs (redirect_uri, etc.)
- Consulter les erreurs API pour comprendre le probl√®me

## üóÑÔ∏è GESTION DES SCRIPTS SQL (SUPABASE)

**R√àGLES CRITIQUES:**

1. **‚ùå INTERDICTION de cr√©er des fichiers .sql dans le projet** (sauf migrations n√©cessaires dans `refactor/vdi/sql/`)
2. **‚úÖ TOUJOURS pr√©senter les scripts SQL directement dans le chat**
3. **Format obligatoire:**
   - Bloc de code Markdown unique et isol√©
   - Bouton "Copy" imm√©diatement utilisable
   - Script "pr√™t √† l'emploi" (avec `IF NOT EXISTS`, RLS policies, etc.)
4. **Instructions explicites:**
   - Demander √† l'utilisateur de copier le bloc
   - Indiquer "Supabase Dashboard ‚Üí SQL Editor ‚Üí Coller et ex√©cuter"

**Exemple correct:**
```
Voici le script SQL √† ex√©cuter:

```sql
-- Description du script
CREATE TABLE IF NOT EXISTS...
```

Copiez ce script et ex√©cutez-le dans **Supabase Dashboard ‚Üí SQL Editor**.
```



